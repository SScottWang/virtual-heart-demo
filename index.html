<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="None" /><link rel="canonical" href="https://sscottwang.github.io/virtual-heart-demo/" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>Preliminary Results: 4D Virtual Heart</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Home";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = "/virtual-heart-demo/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> Preliminary Results: 4D Virtual Heart
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Home</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#rapid-prototyping-strategy">üß¨ Rapid Prototyping Strategy</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#the-dataset-3d-mouse-heart-mosta">üêÅ The Dataset: 3D Mouse Heart (MOSTA)</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#interactive-3d-visualization">Interactive 3D Visualization</a>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">Preliminary Results: 4D Virtual Heart</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Home</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="1-data-processing-model-architecture">1. Data Processing &amp; Model Architecture</h2>
<h3 id="rapid-prototyping-strategy">üß¨ Rapid Prototyping Strategy</h3>
<p>To get a quick baseline given the short timeline, I used <strong>Geneformer</strong> [<a href="https://doi.org/10.1038/s41586-023-06139-9">Theodoris et al., Nature 2023</a>]. It is pretrained on human data, allowing me to start immediately without spending weeks training a foundation model from scratch.</p>
<div class="admonition note">
<p class="admonition-title">Current Limitations</p>
<p>This is a preliminary demo, so there are a few technical trade-offs:</p>
<ul>
<li><strong>Cross-Species Mapping</strong>: I mapped Mouse genes to Human IDs via homology. This introduces some noise since regulatory elements aren't always conserved.</li>
<li><strong>Tokenization Bias</strong>: The model uses <strong>rank-value encoding</strong>. As shown in the embedding analysis, this strategy creates a <strong>"Length Bias"</strong> (dependency on <code>n_counts</code>) when used in zero-shot tasks.</li>
<li><strong>Future Optimization</strong>: Moving to model architectures that treat expression profiles as structured/tabular inputs might help mitigate these depth-related artifacts.</li>
</ul>
</div>
<h3 id="the-dataset-3d-mouse-heart-mosta">üêÅ The Dataset: 3D Mouse Heart (MOSTA)</h3>
<p>The study utilizes the <strong>MOSTA</strong> (Mouse Organogenesis Spatiotemporal Transcriptomic Atlas) dataset [<a href="https://doi.org/10.1016/j.cell.2022.04.003">Chen et al., Cell 2022</a>]. The analysis focuses on two critical developmental stages:</p>
<ul>
<li><strong>E9.5</strong>: Characterized by heart looping and Outflow Tract (OFT) formation.</li>
<li><strong>E11.5</strong>: Characterized by ventricular septation and chamber maturation.</li>
</ul>
<h3 id="interactive-3d-visualization">Interactive 3D Visualization</h3>
<p>Below are the reconstructed 3D spatial maps of the heart samples processed in this workflow.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">üñ±Ô∏è Mouse E9.5 Heart</label><label for="__tabbed_1_2">üñ±Ô∏è Mouse E11.5 Heart</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><iframe src="assets/plots/3d_heart_E9.5.html" width="100%" height="600px" frameborder="0"></iframe></p>
</div>
<div class="tabbed-block">
<p><iframe src="assets/plots/3d_heart_E11.5.html" width="100%" height="600px" frameborder="0"></iframe></p>
</div>
</div>
</div>
<hr />
<h2 id="2-embedding-space-analysis">2. Embedding Space Analysis</h2>
<h3 id="analysis-of-embedding-bias">üîç Analysis of Embedding Bias</h3>
<p>Without fine-tuning, the raw embeddings show a strong correlation with sequencing depth (<code>n_counts</code>). This is caused by the <strong>rank-value encoding strategy</strong>, where the sequence length relates directly to the total number of detected genes.</p>
<ul>
<li><strong>Observation</strong>: In the raw UMAP, we see some initial geometric structures. However, the cell types are intermixed, and the main topology follows the gradient of total read counts (<code>n_counts</code>).</li>
<li><strong>Correction Method</strong>: I attempted to mitigate this by using a linear regression model to remove the variance explained by <code>log1p(n_counts)</code>. This reduced the depth effect to some extent.</li>
<li><strong>Result &amp; Interpretation</strong>: Post-correction, the embedding space revealed more complex manifolds. While <code>n_counts</code> bias persists, the remaining structures likely encode orthogonal biological signals such as <strong>cell cycle phases</strong> or <strong>metabolic states</strong>. In rapidly proliferating embryonic tissues, these states are often biologically coupled with total RNA content, creating a complex signal that simple regression cannot fully disentangle without explicit biological supervision.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Embedding Visualization</p>
<p>Select a developmental stage to compare the embedding landscape before and after regression.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">üìÖ Stage: E9.5</label><label for="__tabbed_2_2">üìÖ Stage: E11.5</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Original UMAP (Bias)</label><label for="__tabbed_3_2">Regressed UMAP (Improved)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>The distribution is dominated by the <code>n_counts</code> gradient.
<img alt="UMAP Raw" src="assets/images/umap_mouse_E9p5_heart_cosine.png" width="600" /></p>
</div>
<div class="tabbed-block">
<p>Emergence of complex manifolds, though lineage separation requires further fine-tuning.
<img alt="UMAP Regressed" src="assets/images/umap_mouse_E9p5_heart_corrected.png" width="600" /></p>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Original UMAP (Bias)</label><label for="__tabbed_4_2">Regressed UMAP (Improved)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><img alt="UMAP Raw" src="assets/images/umap_mouse_E11p5_heart_cosine.png" width="600" /></p>
</div>
<div class="tabbed-block">
<p><img alt="UMAP Regressed" src="assets/images/umap_mouse_E11p5_heart_corrected.png" width="600" /></p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr />
<h2 id="3-spatiotemporal-in-silico-perturbation">3. Spatiotemporal In Silico Perturbation</h2>
<p>I performed <em>in silico</em> deletion of key transcription factors to predict their functional impact on cardiac morphogenesis.</p>
<h3 id="gene-selection-rationale">üéØ Gene Selection Rationale</h3>
<ul>
<li><strong>Nkx2-5 (The Validator)</strong>: Essential for myocardial differentiation. Loss leads to Outflow Tract (OFT) defects (e.g., Tetralogy of Fallot). <strong>Selected to validate model sensitivity against known biology.</strong></li>
<li><strong>Bmpr2 (The Disease Model)</strong>: Critical for vascular endothelium. Mutations are linked to PAH. <strong>Selected to demonstrate relevance to vascular pathology.</strong></li>
<li><strong>Tbx5 (The Spatial Control)</strong>: Expressed specifically in the left ventricle and atria. <strong>Selected to test the spatial specificity of the predictions.</strong></li>
</ul>
<h3 id="impact-score-definition">üìä Impact Score Definition</h3>
<p>The <strong>"Impact Score"</strong> quantifies the phenotype shift caused by the perturbation. It is calculated as the cosine distance between the embedding vectors of the original cell (E_orig) and the perturbed cell (E_perturb):</p>
<p><img src="assets/images/Impact.png" alt="Impact Formula" style="display: block; margin: 0 auto; width: 350px;"></p>
<p>A higher score indicates a significant loss or shift of cellular identity.</p>
<h3 id="interactive-3d-impact-map">üîÆ Interactive 3D Impact Map</h3>
<div class="admonition tip">
<p class="admonition-title">Interactive Discovery: Isolate the OFT</p>
<p>For <strong>E9.5 Nkx2-5</strong>:
The impact is highly localized. To visualize this clearly: <strong>Select the 'Outflow Tract' label</strong> in the figure legend. This will isolate the OFT structure, revealing an intense concentration of high impact scores (red hotspot) that aligns with the etiology of Tetralogy of Fallot.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">üìÖ Stage: E9.5 (Early)</label><label for="__tabbed_5_2">üìÖ Stage: E11.5 (Mid)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="6:3"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><input id="__tabbed_6_3" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">üß¨ Nkx2-5</label><label for="__tabbed_6_2">üß¨ Bmpr2</label><label for="__tabbed_6_3">üß¨ Tbx5</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Prediction</strong>: Strong impact localized to the <strong>Outflow Tract (OFT)</strong>.
<iframe src="assets/plots/E9p5_Nkx2-5_comparison_3d.html" width="100%" height="500px" frameborder="0"></iframe></p>
</div>
<div class="tabbed-block">
<p><strong>Prediction</strong>: Localized impact on endothelial/endocardial populations.
<iframe src="assets/plots/E9p5_Bmpr2_comparison_3d.html" width="100%" height="500px" frameborder="0"></iframe></p>
</div>
<div class="tabbed-block">
<p><strong>Prediction</strong>: Impact concentrated in the primitive Atrium and Left Ventricle.
<iframe src="assets/plots/E9p5_Tbx5_comparison_3d.html" width="100%" height="500px" frameborder="0"></iframe></p>
</div>
</div>
</div>
</div>
<div class="tabbed-block">
<div class="tabbed-set tabbed-alternate" data-tabs="7:3"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><input id="__tabbed_7_3" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">üß¨ Nkx2-5</label><label for="__tabbed_7_2">üß¨ Bmpr2</label><label for="__tabbed_7_3">üß¨ Tbx5</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Prediction</strong>: Impact shifts towards the Ventricular Septum and chamber walls.
<iframe src="assets/plots/E11p5_Nkx2-5_comparison_3d.html" width="100%" height="500px" frameborder="0"></iframe></p>
</div>
<div class="tabbed-block">
<p><iframe src="assets/plots/E11p5_Bmpr2_comparison_3d.html" width="100%" height="500px" frameborder="0"></iframe></p>
</div>
<div class="tabbed-block">
<p><iframe src="assets/plots/E11p5_Tbx5_comparison_3d.html" width="100%" height="500px" frameborder="0"></iframe></p>
</div>
</div>
</div>
</div>
</div>
</div>
<hr />
<h3 id="quantitative-analysis-cell-type-vulnerability">üìà Quantitative Analysis: Cell Type Vulnerability</h3>
<p>To quantify the "Functional Shift" over developmental time, I aggregated the impact scores by annotated cell types.</p>
<div class="admonition abstract">
<p class="admonition-title">Biological Interpretation: The Critical Window</p>
<p>The aggregated impact scores reveal a striking spatiotemporal dynamic for <strong>Nkx2-5</strong>:</p>
<p>At <strong>E9.5</strong>, the <em>Nkx2-5</em> deletion yields the highest impact score (<strong>1.7e-5</strong>) specifically in the <strong>Outflow Tract (OFT)</strong>, which is nearly <strong>8x higher</strong> than in the Right Ventricle. This computationally recapitulates the "Critical Window" for OFT formation, identifying it as the most vulnerable structure to <em>Nkx2-5</em> loss at this specific stage. </p>
<p>By <strong>E11.5</strong>, this focused impact dissipates (decreasing to 0.3e-5), mirroring the anatomical timeline where OFT morphogenesis concludes and septation begins.</p>
</div>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Heatmap: E9.5</label><label for="__tabbed_8_2">Heatmap: E11.5</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><img alt="Heatmap E9.5" src="assets/images/E9p5_multi_gene_heatmap.png" /></p>
</div>
<div class="tabbed-block">
<p><img alt="Heatmap E11.5" src="assets/images/E11p5_multi_gene_heatmap.png" /></p>
</div>
</div>
</div>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>

<!--
MkDocs version : 1.6.1
Build Date UTC : 2025-12-25 19:37:57.235199+00:00
-->
